import { toParts, toCJS, toESM, isESM, isComponentPath, replaceExtension } from '@ractivejs/utils-component'

export default function (options) {
  return {
    name: '@ractivejs/loader-rollup',
    transform: (content, id) => {
      if (!isComponentPath(id) || id.indexOf('commonjs-proxy:') !== -1) return null
      const parts = toParts(content)
      const moduler = isESM((parts.script && parts.script.code) || '') ? toESM : toCJS
      const srcName = id
      const destName = replaceExtension(id, '.js')
      return moduler({ srcName, destName, parts })
    }
  }
}
