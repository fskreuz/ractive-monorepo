<template>
  <div></div>
</template>

<style>
  .ace {
    min-height: 300px;
    height: 100%;
  }
</style>

<script>
  import ace from 'ace'

  export default {
    data: {
      value: '',
      mode: 'html',
      theme: null
    },
    oncomplete: function () {
      let updating = false
      const editor = ace.edit(this.find('div'))
      editor.$blockScrolling = Infinity

      editor.getSession().on('change', () => {
        if (updating) return
        updating = true
        this.set('value', editor.getValue())
        updating = false
      })

      this.observe('value', val => {
        if (updating) return
        updating = true
        if (!val && typeof (val) !== 'string') val = ''
        editor.setValue(val, -1)
        updating = false
      })

      this.observe('mode', val => {
        editor.getSession().setMode(val ? `ace/mode/${val}` : null)
      })

      this.observe('theme', val => {
        editor.setTheme(val ? `ace/theme/${val}` : null)
      })
    }
  }

</script>
